/*!
 *
 * Selectable
 * Copyright (c) 2017 Karl Saunders (http://mobiuswebdesign.co.uk)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 0.0.1
 *
 */
!function(a,b){var c="Selectable";"function"==typeof define&&define.amd?define([],b(c)):"object"==typeof exports?module.exports=b(c):a[c]=b(c)}(this,function(a){"use strict";function i(a){var i={appendTo:"body",autoRefresh:!0,filter:"*",tolerance:"touch",lasso:{border:"1px solid #3498db",backgroundColor:"rgba(52, 152, 219, 0.2)"}};this.options=c(i,a);var j=document.createElement("div");if(j.className="ui-lasso",j.style.position="fixed",d(this.options.lasso,function(a,b){j.style[a]=b}),this.lasso=j,"string"==typeof this.options.appendTo||this.options.appendTo instanceof String)this.container=document.querySelector(this.options.appendTo);else{if(!this.options.appendTo.nodeName)throw new Error("You must select container to append to.");this.container=this.options.appendTo}this.refresh=function(){var a=this;this.elements=document.querySelectorAll(this.options.selector),this.items=[],d(this.elements,function(b,c){a.items[b]={element:c,rect:c.getBoundingClientRect(),startselected:!1,selected:c.classList.contains("ui-selected"),selecting:c.classList.contains("ui-selecting"),unselecting:c.classList.contains("ui-unselecting")},c.ondragstart=function(a){f(a)}})},this.refresh(),this.mousedown=function(a){f(a);var c,b=this.options,e=a.target,g=e.classList.contains(b.selector.replace(".",""));this.container.appendChild(this.lasso),this.origin={x:a.pageX,y:a.pageY},b.disabled||(g&&e.classList.add("ui-selecting"),b.autoRefresh&&this.refresh(),d(this.items,function(b,d){var f=d.element;d.selected&&(d.startselected=!0,a.metaKey||a.ctrlKey||(f.classList.remove("ui-selected"),d.selected=!1,f.classList.add("ui-unselecting"),d.unselecting=!0)),f===e&&(c=d)}),this.dragging=!0,g&&this.trigger("selectable.down",c))},this.mousemove=function(a){if(this.dragging){var c=this.options;if(!c.disabled){var e,f={x1:this.origin.x,y1:this.origin.y,x2:a.pageX,y2:a.pageY};f.x1>f.x2&&(e=f.x2,f.x2=f.x1,f.x1=e),f.y1>f.y2&&(e=f.y2,f.y2=f.y1,f.y1=e),b(this.lasso,"left",f.x1),b(this.lasso,"width",f.x2-f.x1),b(this.lasso,"top",f.y1),b(this.lasso,"height",f.y2-f.y1),d(this.items,function(b,d){var e=d.element,g=!1;"touch"==c.tolerance?g=!(d.rect.left>f.x2||d.rect.right<f.x1||d.rect.top>f.y2||d.rect.bottom<f.y1):"fit"==c.tolerance&&(g=d.rect.left>f.x1&&d.rect.right<f.x2&&d.rect.top>f.y1&&d.rect.bottom<f.y2),g?(d.selected&&(e.classList.remove("ui-selected"),d.selected=!1),d.unselecting&&(e.classList.remove("ui-unselecting"),d.unselecting=!1),d.selecting||(e.classList.add("ui-selecting"),d.selecting=!0)):(d.selecting&&((a.metaKey||a.ctrlKey)&&d.startselected?(e.classList.remove("ui-selecting"),d.selecting=!1,e.classList.add("ui-selected"),d.selected=!0):(e.classList.remove("ui-selecting"),d.selecting=!1,d.startselected&&(e.classList.add("ui-unselecting"),d.unselecting=!0))),e.selected&&(a.metaKey||a.ctrlKey||d.startselected||(e.classList.remove("ui-selected"),d.selected=!1,e.classList.add("ui-unselecting"),d.unselecting=!0)))}),this.trigger("selectable.drag",f)}}},this.mouseup=function(a){if(this.dragging&&(this.dragging=!1),this.container.contains(a.target)){var c=this;this.selectedItems=[],b(this.lasso,"top",0),b(this.lasso,"left",0),b(this.lasso,"width",0),b(this.lasso,"height",0),d(this.items,function(a,b){var d=b.element;b.unselecting&&(d.classList.remove("ui-unselecting"),b.unselecting=!1,b.startselected=!1),b.selecting&&(d.classList.remove("ui-selecting"),d.classList.add("ui-selected"),b.selecting=!1,b.selected=!0,b.startselected=!0),b.selected&&(c.selectedItems.push(b),c.trigger("selectable.selected",b))}),this.container.removeChild(this.lasso),this.trigger("selectable.up",this.selectedItems)}},this.downHandler=this.mousedown.bind(this),this.moveHandler=this.mousemove.bind(this),this.upHandler=this.mouseup.bind(this),g(this.container,"mousedown",this.downHandler),g(document,"mousemove",this.moveHandler),g(document,"mouseup",this.upHandler),this.update=e(function(){d(that.elements,function(a,b){that.items[a].rect=b.getBoundingClientRect()})},50),g(window,"resize",this.update),g(window,"scroll",this.update),h.mixin(this)}var b=function(a,b,c){var d=a&&a.style;if(d){if(void 0===c)return document.defaultView&&document.defaultView.getComputedStyle?c=document.defaultView.getComputedStyle(a,""):a.currentStyle&&(c=a.currentStyle),void 0===b?c:c[b];b in d||(b="-webkit-"+b),d[b]=c+("string"==typeof c?"":"px")}},c=function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},d=function(a,b,c){if("[object Object]"===Object.prototype.toString.call(a))for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.call(c,d,a[d],a);else for(var e=0,f=a.length;e<f;e++)b.call(c,e,a[e],a)},e=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}},f=function(a,b){return a=a||window.event,b&&a.stopPropagation(),a.preventDefault?a.preventDefault():a.returnValue=!1},g=function(a,b,c,d){a.addEventListener(b,c,d||!1)},h=function(){};return h.prototype={on:function(a,b){this._events=this._events||{},this._events[a]=this._events[a]||[],this._events[a].push(b)},off:function(a,b){this._events=this._events||{},a in this._events!=0&&this._events[a].splice(this._events[a].indexOf(b),1)},trigger:function(a){if(this._events=this._events||{},a in this._events!=0)for(var b=0;b<this._events[a].length;b++)this._events[a][b].apply(this,Array.prototype.slice.call(arguments,1))}},h.mixin=function(a){for(var b=["on","off","trigger"],c=b.length;c--;)"function"==typeof a?a.prototype[b[c]]=h.prototype[b[c]]:a[b[c]]=h.prototype[b[c]];return a},i.prototype.destroy=function(){this.container.removeEventListener("mousedown",this.downHandler),document.removeEventListener("mousemove",this.moveHandler),document.removeEventListener("mouseup",this.upHandler)},i});