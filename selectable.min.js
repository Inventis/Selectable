/*!
 *
 * Selectable
 * Copyright (c) 2017 Karl Saunders (http://mobius.ovh)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 0.10.1
 *
 */
!function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define([],e):t.Selectable=e()}("undefined"!=typeof global?global:this.window||this.global,function(){"use strict";function t(t){this.version=e,this.config=h(n,t),this.init()}var e="0.10.1",s="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,i="classList"in document.documentElement,n={toggle:!1,autoRefresh:!0,throttle:50,appendTo:document.body,filter:".ui-selectable",tolerance:"touch",shiftDirection:"normal",autoScroll:{offset:40,increment:10},lasso:{border:"1px dotted #000",backgroundColor:"rgba(52, 152, 219, 0.2)"},classes:{lasso:"ui-lasso",selected:"ui-selected",container:"ui-container",selecting:"ui-selecting",selectable:"ui-selectable",unselecting:"ui-unselecting"}},o=function(t,e,s,i){t.addEventListener(e,s,!1)},c=function(t,e,s){t.removeEventListener(e,s)},l=function(t,e){return t&&(e(t)?t:l(t.parentNode,e))},a=function(t){return"[object Object]"===Object.prototype.toString.call(t)},r=function(t){return Array.isArray(t)||t instanceof HTMLCollection||t instanceof NodeList},h=function(t,e){for(var s in e)if(e.hasOwnProperty(s)){var i=e[s];i&&a(i)?(t[s]=t[s]||{},h(t[s],i)):t[s]=i}return t},d=function(t,e,s){var i;if(a(t))for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(s,t[i],i);else for(i=0;i<t.length;i++)e.call(s,t[i],i)},u=function(t,e){var s=t.style;if(t){if(void 0===e)return window.getComputedStyle(t);a(e)&&d(e,function(e,i){i in s||(i="-webkit-"+i),t.style[i]=e+("string"==typeof e?"":"opacity"===i?"":"px")})}},f=function(t){var e=window,s=t.getBoundingClientRect(),i=document.documentElement||document.body.parentNode||document.body,n=void 0!==e.pageXOffset?e.pageXOffset:i.scrollLeft,o=void 0!==e.pageYOffset?e.pageYOffset:i.scrollTop;return{x1:s.left+n,x2:s.left+s.width+n,y1:s.top+o,y2:s.top+s.height+o,height:s.height,width:s.width}},g=function(t,e,s){var i;return function(){if(s=s||this,!i)return t.apply(s,arguments),i=!0,setTimeout(function(){i=!1},e)}},m={add:function(t,e){i?t.classList.add(e):m.contains(t,e)||(t.className=t.className.trim()+" "+e)},remove:function(t,e){i?t.classList.remove(e):m.contains(t,e)&&(t.className=t.className.replace(new RegExp("(^|\\s)"+e.split(" ").join("|")+"(\\s|$)","gi")," "))},contains:function(t,e){if(t)return i?t.classList.contains(e):!!t.className&&!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))}},p=function(t){return!!t.ctrlKey||!!t.metaKey},y=function(t){return!!t.shiftKey};return t.prototype={init:function(){var t=this,e=this.config;this.autoscroll=a(e.autoScroll),this.data={x:0,y:0,right:0,left:0,down:0,up:0},this.lasso=!1,e.lasso&&a(e.lasso)&&(this.lasso=document.createElement("div"),this.lasso.className=e.classes.lasso,u(this.lasso,h({position:"fixed",opacity:0},e.lasso))),this.events={start:this.start.bind(this),drag:this.drag.bind(this),end:this.end.bind(this),keyup:this.keyup.bind(this),keydown:this.keydown.bind(this),recalculate:g(this.recalculate,e.throttle,this)},this.autoscroll&&(this.events.scroll=g(this.scroll,e.throttle,this)),this.setContainer(),this.update(),this.enable(),setTimeout(function(){t.emit("selectable.init")},10)},update:function(){var t=this.config.classes,e=m.contains;this.size={rect:f(this.container),x:this.container.scrollLeft,y:this.container.scrollTop,w:this.container.scrollWidth,h:this.container.scrollHeight},this.items=[],d(this.nodes,function(s,i){m.add(s,t.selectable),this.items[i]={node:s,rect:f(s),startselected:!1,selected:e(s,t.selected),selecting:e(s,t.selecting),unselecting:e(s,t.unselecting)}},this),this.emit("selectable.update",this.items)},bind:function(){var t=this.events;o(this.container,"mousedown",t.start),o(document,"mousemove",t.drag),o(document,"mouseup",t.end),o(document,"keydown",t.keydown),o(document,"keyup",t.keyup),this.autoscroll&&o(this.container,"scroll",t.scroll),o(this.container,"touchstart",t.start),o(document,"touchend",t.end),o(document,"touchcancel",t.end),o(document,"touchmove",t.drag),o(window,"resize",t.recalculate),o(window,"scroll",t.recalculate)},unbind:function(){var t=this.events;c(this.container,"mousedown",t.start),c(document,"mousemove",t.drag),c(document,"mouseup",t.end),c(document,"keydown",t.keydown),c(document,"keyup",t.keyup),this.autoscroll&&c(this.container,"scroll",t.scroll),c(this.container,"touchstart",t.start),c(document,"touchend",t.end),c(document,"touchcancel",t.end),c(document,"touchmove",t.drag),c(window,"resize",t.recalculate),c(window,"scroll",t.recalculate)},start:function(t){if(t.preventDefault(),this.container.contains(t.target)){var e,i=this,n=this.config,o=l(t.target,function(t){return t===i.container||m.contains(t,n.classes.selectable)});if(!o||n.disabled)return!1;var c="touchstart"===t.type;if(this.dragging=!0,this.origin={x:c?t.touches[0].clientX:t.pageX,y:c?t.touches[0].clientY:t.pageY},this.autoscroll&&(this.origin.scroll={x:this.container.scrollLeft,y:this.container.scrollTop}),this.lasso&&this.container.appendChild(this.lasso),o!==this.container&&m.add(o,n.classes.selecting),n.autoRefresh&&this.update(),s){var a=this.get(o);if(a.selected)return this.dragging=!1,void this.unselect(a)}if(y(t)){var r=this.items,h=!1,u=this.items.length,f=function(t){return r[t].node===o&&(h=!0),!(!h||!r[t].selected)||(h&&(r[t].selecting=!0),!1)};if("normal"!==n.shiftDirection)for(var g=0;g<u&&!f(g);g++);else for(;u--&&!f(u););}d(this.items,function(i){var c=i.node;if(i.selected){i.startselected=!0;var l=!1;n.toggle?c===o&&(l=!0):s||p(t)||y(t)||(l=!0),l&&(m.remove(c,n.classes.selected),i.selected=!1,m.add(c,n.classes.unselecting),i.unselecting=!0)}c===o&&(e=i)}),this.startEl=o,this.emit("selectable.start",e)}},drag:function(t){if(this.dragging&&!y(t)&&!this.config.disabled){var e,s,i=this,n="touchstart"===t.type;this.offset=e={x1:this.origin.x,y1:this.origin.y,x2:n?t.touches[0].clientX:t.pageX,y2:n?t.touches[0].clientY:t.pageY,scroll:{x:0,y:0}},this.autoscroll&&(e.scroll={x:this.container.scrollLeft,y:this.container.scrollTop},this.scrolling={x:0,y:0},this.autoScroll(t)),e.x1>e.x2&&(s=e.x2,e.x2=e.x1,e.x1=s),e.y1>e.y2&&(s=e.y2,e.y2=e.y1,e.y1=s),d(this.items,function(e){i.highlight(e,p(t))});var o={x1:e.x1+this.data.right,x2:e.x2+this.data.left-(e.x1+this.data.right),y1:e.y1+this.data.down,y2:e.y2+this.data.up-(e.y1+this.data.down)};this.lasso&&this.updateHelper(o),this.emit("selectable.drag",o)}},end:function(t){if(this.dragging){this.dragging=!1;var e,s=this,i=s.config,n=t.target,o=[],c=[];this.lasso&&this.container.contains(this.lasso)&&this.container.removeChild(this.lasso),this.lasso&&(u(this.lasso,{opacity:0,left:0,width:0,top:0,height:0}),n=document.elementFromPoint(t.pageX,t.pageY)),e=l(n,function(t){return m.contains(t,i.classes.selectable)}),this.data.right=0,this.data.left=0,this.data.down=0,this.data.up=0,d(this.items,function(t){i.toggle&&t.node===e&&t.node===s.startEl&&t.selecting&&t.startselected&&(t.unselecting=!0,t.selecting=!1),t.unselecting&&(c.push(t),this.unselect(t)),t.selecting&&(o.push(t),this.select(t))},this),this.emit("selectable.end",o,c)}},keydown:function(t){this.cmdDown=p(t),this.shiftDown=y(t),this.cmdDown&&(65!=t.keyCode&&97!=t.keyCode||(t.preventDefault(),this.selectAll()))},keyup:function(t){this.cmdDown=p(t),this.shiftDown=y(t)},scroll:function(t){d(this.items,function(t){t.rect=f(t.node)})},updateHelper:function(t){var e={opacity:1,left:t.x1,width:t.x2,top:t.y1,height:t.y2};this.autoscroll&&(e=h(e,{zIndex:0,position:"absolute",left:t.x1-this.size.rect.x1+this.offset.scroll.x,top:t.y1-this.size.rect.y1+this.offset.scroll.y})),u(this.lasso,e)},autoScroll:function(t){var e=this.config.autoScroll,s=this.size.rect,i=this.offset.scroll.x,n=this.offset.scroll.y,o=this.size.w,c=this.size.h,l=0,a=0,r=i,h=n;(n>0||n<c-s.height)&&(t.pageY>=s.y2-e.offset||t.pageY<=s.y1+e.offset)&&(t.pageY>=s.y2-e.offset?(a=e.increment,this.scrolling.y=1):t.pageY<=s.y1+e.offset&&(a=-e.increment,this.scrolling.y=-1),h+=a,this.container.scrollTop=this.offset.scroll.y=h),(i>0||i<o-s.width)&&(t.pageX>=s.x2-e.offset||t.pageX<=s.x1+e.offset)&&(t.pageX>=s.x2-e.offset?(l=e.increment,this.scrolling.x=1):t.pageX<=s.x1+e.offset&&(l=-e.increment,this.scrolling.x=-1),r+=l,this.container.scrollLeft=this.offset.scroll.x=r),this.data.x=this.origin.scroll.x-this.offset.scroll.x,this.data.y=this.origin.scroll.y-this.offset.scroll.y,this.scrolling.x>0?this.data.right=this.data.x:this.scrolling.x<0&&(this.data.left=this.data.x),this.scrolling.y>0?this.data.down=this.data.y:this.scrolling.y<0&&(this.data.up=this.data.y)},highlight:function(t,e){var s=this.offset,i=this.config,n=i.classes,o=t.node,c=t.rect,l=this.data,a=!1;"touch"==i.tolerance?a=!(c.x1>s.x2+l.left||c.x2<s.x1+l.right||c.y1>s.y2+l.up||c.y2<s.y1+l.down):"fit"==i.tolerance&&(a=c.x1>s.x1+l.right&&c.x2<s.x2+l.left&&c.y1>s.y1+l.down&&c.y2<s.y2+l.up),a?(t.selected&&!i.toggle&&(m.remove(o,n.selected),t.selected=!1),t.unselecting&&(!i.toggle||i.toggle&&"drag"!==i.toggle)&&(m.remove(o,n.unselecting),t.unselecting=!1),t.selecting||(m.add(o,n.selecting),t.selecting=!0)):(t.selecting&&(e&&t.startselected?(m.remove(o,n.selecting),t.selecting=!1,m.add(o,n.selected),t.selected=!0):(m.remove(o,n.selecting),t.selecting=!1,t.startselected&&!i.toggle&&(m.add(o,n.unselecting),t.unselecting=!0))),o.selected&&(e||t.startselected||(m.remove(o,n.selected),t.selected=!1,m.add(o,n.unselecting),t.unselecting=!0)))},setContainer:function(t){var e,s=this.config;this.container&&(e=this.container,this.unbind()),"string"==typeof(t=t||s.appendTo)?this.container=document.querySelector(t):t instanceof Element&&t.nodeName&&(this.container=t),m.add(this.container,this.config.classes.container),e&&m.remove(e,this.config.classes.container),r(s.filter)?this.nodes=[].slice.call(s.filter):"string"==typeof s.filter&&(this.nodes=[].slice.call(this.container.querySelectorAll(s.filter))),this.autoscroll&&"static"===u(this.container).position&&u(this.container,{position:"relative"}),this.bind()},select:function(t,e){if(r(t))return d(t,function(t){this.select(t)},this),this.getSelectedItems();if(t=this.get(t)){if(this.config.toggle&&"drag"===this.config.toggle&&!e&&t.selected&&!this.cmdDown)return this.unselect(t);var s=t.node,i=this.config.classes;return m.remove(s,i.selecting),m.add(s,i.selected),t.selecting=!1,t.selected=!0,t.startselected=!0,this.emit("selectable.select",t),t}return!1},unselect:function(t){if(r(t))return d(t,function(t){this.unselect(t)},this),this.getSelectedItems();if(t=this.get(t)){var e=t.node,s=this.config.classes;return t.selecting=!1,t.selected=!1,t.unselecting=!1,t.startselected=!1,m.remove(e,s.unselecting),m.remove(e,s.selecting),m.remove(e,s.selected),this.emit("selectable.unselect",t),t}return!1},add:function(t){r(t)?d(t,function(t){this.nodes.indexOf(t)<0&&t instanceof Element&&this.nodes.push(t)},this):this.nodes.indexOf(t)<0&&t instanceof Element&&this.nodes.push(t),this.update()},remove:function(t,e){if(t=this.get(t)){if(r(t))for(var s=t.length-1;s>=0;s--)this.remove(t[s],s>0);else{var i=t.node,n=this.config.classes,o=m.remove;o(i,n.selectable),o(i,n.unselecting),o(i,n.selecting),o(i,n.selected),this.nodes.splice(this.nodes.indexOf(t.node),1)}return e||this.update(),!0}return!1},recalculate:function(){d(this.nodes,function(t,e){this.items[e].rect=f(t)},this),this.emit("selectable.recalculate")},selectAll:function(){d(this.items,function(t){this.select(t,!0)},this)},clear:function(){for(var t=this.items.length-1;t>=0;t--)this.unselect(this.items[t])},get:function(t){var e=!1;return r(t)?(e=[],d(t,function(t){(t=this.get(t))&&e.push(t)},this)):isNaN(t)?t instanceof Element?e=this.items[this.nodes.indexOf(t)]:a(t)&&this.items.indexOf(t)>=0&&(e=t):this.items.indexOf(this.items[t])>=0&&(e=this.items[t]),e},getItems:function(){return this.items},getNodes:function(){return this.nodes},getSelectedItems:function(){return this.getItems().filter(function(t){return t.selected})},getSelectedNodes:function(){return this.getSelectedItems().map(function(t){return t.node})},on:function(t,e){this.events=this.events||{},this.events[t]=this.events[t]||[],this.events[t].push(e)},off:function(t,e){this.events=this.events||{},t in this.events!=!1&&this.events[t].splice(this.events[t].indexOf(e),1)},emit:function(t){if(this.events=this.events||{},t in this.events!=!1)for(var e=0;e<this.events[t].length;e++)this.events[t][e].apply(this,Array.prototype.slice.call(arguments,1))},enable:function(){return this.enabled||(this.enabled=!0,this.bind(),m.add(this.container,this.config.classes.container),this.emit("selectable.enable")),this.enabled},disable:function(){return this.enabled&&(this.enabled=!1,this.unbind(),m.remove(this.container,this.config.classes.container),this.emit("selectable.disable")),this.enabled},destroy:function(){this.disable(),this.remove(this.items),d(this,function(t,e){"version"!==e&&"config"!==e&&delete this[e]},this)}},t});