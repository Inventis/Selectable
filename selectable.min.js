/*!
 *
 * Selectable
 * Copyright (c) 2017 Karl Saunders (http://mobius.ovh)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 0.0.4
 *
 */
!function(e,t){var s="Selectable";"function"==typeof define&&define.amd?define([],t(s)):"object"==typeof exports?module.exports=t(s):e[s]=t(s)}(this,function(e){"use strict";function t(e,t,s,i){e.addEventListener(t,s,!1)}function s(e,t,s){e.removeEventListener(t,s)}function i(e,t,s){if("[object Object]"===Object.prototype.toString.call(e))for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(s,i,e[i]);else for(var n=0,o=e.length;n<o;n++)t.call(s,n,e[n])}function n(e,t){t=t||{};var s;for(s in e)e.hasOwnProperty(s)&&(t.hasOwnProperty(s)||(t[s]=e[s]));return t}function o(e,t,s){var n=e&&e.style,o="[object Object]"===Object.prototype.toString.call(t);if(n){if(void 0===s&&!o)return s=window.getComputedStyle(e,""),void 0===t?s:s[t];o?i(t,function(e,t){e in n||(e="-webkit-"+e),n[e]=t+("string"==typeof t?"":"opacity"===e?"":"px")}):(t in n||(t="-webkit-"+t),n[t]=s+("string"==typeof s?"":"opacity"===t?"":"px"))}}function c(e){this.options=n(l,e),d.mixin(this),this.init()}var l={appendTo:"body",autoRefresh:!0,filter:"*",tolerance:"touch",lasso:{border:"1px solid #3498db",backgroundColor:"rgba(52, 152, 219, 0.2)"}},r=function(e,t,s){var i;return function(){var n=this,o=arguments,c=function(){i=null,s||e.apply(n,o)},l=s&&!i;clearTimeout(i),i=setTimeout(c,t),l&&e.apply(n,o)}},a=function(e){return e=e||window.event,e.preventDefault?e.preventDefault():e.returnValue=!1},u=function(e){return!!e.ctrlKey||!!e.metaKey},d=function(){};return d.prototype={on:function(e,t){this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t)},off:function(e,t){this._events=this._events||{},e in this._events!=0&&this._events[e].splice(this._events[e].indexOf(t),1)},emit:function(e){if(this._events=this._events||{},e in this._events!=0)for(var t=0;t<this._events[e].length;t++)this._events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}},d.mixin=function(e){for(var t=["on","off","emit"],s=t.length;s--;)"function"==typeof e?e.prototype[t[s]]=d.prototype[t[s]]:e[t[s]]=d.prototype[t[s]];return e},c.prototype.init=function(){var e=document.createElement("div");e.className="ui-lasso",e.style.position="fixed",i(this.options.lasso,function(t,s){e.style[t]=s}),this.lasso=e,"string"==typeof this.options.appendTo||this.options.appendTo instanceof String?this.container=document.querySelector(this.options.appendTo):this.options.appendTo.nodeName?this.container=this.options.appendTo:this.container=document.body,this.refresh(),this.events={mousedown:this.mousedown.bind(this),mousemove:this.mousemove.bind(this),mouseup:this.mouseup.bind(this),update:r(this.update,50).bind(this)},t(this.container,"mousedown",this.events.mousedown),t(document,"mousemove",this.events.mousemove),t(document,"mouseup",this.events.mouseup),t(window,"resize",this.events.update),t(window,"scroll",this.events.update)},c.prototype.refresh=function(){var e=this;this.els=this.container.querySelectorAll(this.options.selector),this.items=[],i(this.els,function(t,s){e.items[t]={element:s,rect:s.getBoundingClientRect(),startselected:!1,selected:s.classList.contains("ui-selected"),selecting:s.classList.contains("ui-selecting"),unselecting:s.classList.contains("ui-unselecting")},s.ondragstart=function(e){a(e)}})},c.prototype.mousedown=function(e){a(e);var t,s=this.options,n=e.target,o=n.classList.contains(s.selector.replace(".",""));this.container.appendChild(this.lasso),this.origin={x:e.pageX,y:e.pageY},s.disabled||(o&&n.classList.add("ui-selecting"),s.autoRefresh&&this.refresh(),i(this.items,function(s,i){var o=i.element;i.selected&&(i.startselected=!0,u(e)||(o.classList.remove("ui-selected"),i.selected=!1,o.classList.add("ui-unselecting"),i.unselecting=!0)),o===n&&(t=i)}),this.dragging=!0,o&&this.emit("selectable.down",t))},c.prototype.mousemove=function(e){if(this.dragging){var t=this.options;if(!t.disabled){var s,n={x1:this.origin.x,y1:this.origin.y,x2:e.pageX,y2:e.pageY};n.x1>n.x2&&(s=n.x2,n.x2=n.x1,n.x1=s),n.y1>n.y2&&(s=n.y2,n.y2=n.y1,n.y1=s),o(this.lasso,{left:n.x1,width:n.x2-n.x1,top:n.y1,height:n.y2-n.y1}),i(this.items,function(s,i){var o=i.element,c=!1;"touch"==t.tolerance?c=!(i.rect.left>n.x2||i.rect.right<n.x1||i.rect.top>n.y2||i.rect.bottom<n.y1):"fit"==t.tolerance&&(c=i.rect.left>n.x1&&i.rect.right<n.x2&&i.rect.top>n.y1&&i.rect.bottom<n.y2),c?(i.selected&&(o.classList.remove("ui-selected"),i.selected=!1),i.unselecting&&(o.classList.remove("ui-unselecting"),i.unselecting=!1),i.selecting||(o.classList.add("ui-selecting"),i.selecting=!0)):(i.selecting&&(u(e)&&i.startselected?(o.classList.remove("ui-selecting"),i.selecting=!1,o.classList.add("ui-selected"),i.selected=!0):(o.classList.remove("ui-selecting"),i.selecting=!1,i.startselected&&(o.classList.add("ui-unselecting"),i.unselecting=!0))),o.selected&&(u(e)||i.startselected||(o.classList.remove("ui-selected"),i.selected=!1,o.classList.add("ui-unselecting"),i.unselecting=!0)))}),this.emit("selectable.drag",n)}}},c.prototype.mouseup=function(e){if(this.dragging&&(this.dragging=!1),this.container.contains(e.target)){var t=this;this.selectedItems=[],o(this.lasso,{left:0,width:0,top:0,height:0}),i(this.items,function(e,s){var i=s.element;s.unselecting&&(i.classList.remove("ui-unselecting"),s.unselecting=!1,s.startselected=!1),s.selecting&&(i.classList.remove("ui-selecting"),i.classList.add("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0),s.selected&&(t.selectedItems.push(s),t.emit("selectable.selected",s))}),this.container.removeChild(this.lasso),this.emit("selectable.up",this.selectedItems)}},c.prototype.update=function(){i(this.els,function(e,t){this.items[e].rect=t.getBoundingClientRect()},this)},c.prototype.destroy=function(){i(this.items,function(e,t){var s=t.element;s.classList.remove("ui-unselecting"),s.classList.remove("ui-selecting"),s.classList.remove("ui-selected")}),s(this.container,"mousedown",this.events.mousedown),s(document,"mousemove",this.events.mousemove),s(document,"mouseup",this.events.mouseup),s(window,"resize",this.events.update),s(window,"scroll",this.events.update)},c});