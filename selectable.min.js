/*!
 *
 * Selectable
 * Copyright (c) 2017 Karl Saunders (http://mobius.ovh)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 0.9.1
 *
 */
!function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define([],e):t.Selectable=e()}("undefined"!=typeof global?global:this.window||this.global,function(){"use strict";function t(t){this.version=e,this.config=h(n,t),this.init()}var e="0.9.1",i="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,s="classList"in document.documentElement,n={multiple:!0,autoRefresh:!0,throttle:50,appendTo:document.body,filter:".ui-selectable",tolerance:"touch",shiftDirection:"normal",autoScroll:{offset:40,increment:10},lasso:{border:"1px dotted #000",backgroundColor:"rgba(52, 152, 219, 0.2)"},classes:{lasso:"ui-lasso",multiple:"ui-multiple",selected:"ui-selected",container:"ui-container",selecting:"ui-selecting",selectable:"ui-selectable",unselecting:"ui-unselecting"}},o=function(t,e,i,s){t.addEventListener(e,i,!1)},c=function(t,e,i){t.removeEventListener(e,i)},l=function(t,e){return t&&(e(t)?t:l(t.parentNode,e))},r=function(t){return"[object Object]"===Object.prototype.toString.call(t)},a=function(t){return Array.isArray(t)||t instanceof HTMLCollection||t instanceof NodeList},h=function(t,e){for(var i in e)if(e.hasOwnProperty(i)){var s=e[i];s&&r(s)?(t[i]=t[i]||{},h(t[i],s)):t[i]=s}return t},d=function(t,e,i){var s;if(r(t))for(s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.call(i,t[s],s);else for(s=0;s<t.length;s++)e.call(i,t[s],s)},u=function(t,e,i){var s=t&&t.style,n=r(e);if(s){if(void 0===i&&!n)return i=window.getComputedStyle(t,""),void 0===e?i:i[e];n?d(e,function(t,e){e in s||(e="-webkit-"+e),s[e]=t+("string"==typeof t?"":"opacity"===e?"":"px")}):(e in s||(e="-webkit-"+e),s[e]=i+("string"==typeof i?"":"opacity"===e?"":"px"))}},f=function(t){var e=window,i=t.getBoundingClientRect(),s=document.documentElement||document.body.parentNode||document.body,n=void 0!==e.pageXOffset?e.pageXOffset:s.scrollLeft,o=void 0!==e.pageYOffset?e.pageYOffset:s.scrollTop;return{x1:i.left+n,x2:i.left+i.width+n,y1:i.top+o,y2:i.top+i.height+o,height:i.height,width:i.width}},p=function(t,e,i){var s;return function(){var n=this,o=arguments,c=i&&!s;clearTimeout(s),s=setTimeout(function(){s=null,i||t.apply(n,o)},e),c&&t.apply(n,o)}},g={add:function(t,e){s?t.classList.add(e):g.contains(t,e)||(t.className=t.className.trim()+" "+e)},remove:function(t,e){s?t.classList.remove(e):g.contains(t,e)&&(t.className=t.className.replace(new RegExp("(^|\\s)"+e.split(" ").join("|")+"(\\s|$)","gi")," "))},contains:function(t,e){if(t)return s?t.classList.contains(e):!!t.className&&!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))}},m=function(t){return!!t.ctrlKey||!!t.metaKey},y=function(t){return!!t.shiftKey};return t.prototype.init=function(){var t=this,e=this.config;this.autoscroll=r(e.autoScroll),this.data={x:0,y:0,right:0,left:0,down:0,up:0},this.lasso=document.createElement("div"),this.lasso.className=e.classes.lasso,u(this.lasso,h({position:"fixed",opacity:0},e.lasso)),this.events={start:this.start.bind(this),drag:this.drag.bind(this),end:this.end.bind(this),keydown:this.keydown.bind(this),recalculate:p(this.recalculate,e.throttle).bind(this)},this.autoscroll&&(this.events.scroll=p(this.scroll,e.throttle).bind(this)),this.setContainer(),this.update(),this.enable(),setTimeout(function(){t.emit("selectable.init")},10)},t.prototype.update=function(){var t=this.config.classes,e=g.contains;this.size={rect:f(this.container),x:this.container.scrollLeft,y:this.container.scrollTop,w:this.container.scrollWidth,h:this.container.scrollHeight},this.items=[],d(this.nodes,function(i,s){g.add(i,t.selectable),this.items[s]={node:i,rect:f(i),startselected:!1,selected:e(i,t.selected),selecting:e(i,t.selecting),unselecting:e(i,t.unselecting)}},this),this.emit("selectable.update",this.items)},t.prototype.bind=function(){var t=this.events;o(this.container,"mousedown",t.start),o(document,"mousemove",t.drag),o(document,"mouseup",t.end),o(document,"keydown",t.keydown),this.autoscroll&&o(this.container,"scroll",t.scroll),o(this.container,"touchstart",t.start),o(document,"touchend",t.end),o(document,"touchcancel",t.end),o(document,"touchmove",t.drag),o(window,"resize",t.recalculate),o(window,"scroll",t.recalculate)},t.prototype.unbind=function(){var t=this.events;c(this.container,"mousedown",t.start),c(document,"mousemove",t.drag),c(document,"mouseup",t.end),c(document,"keydown",t.keydown),this.autoscroll&&c(this.container,"scroll",t.scroll),c(this.container,"touchstart",t.start),c(document,"touchend",t.end),c(document,"touchcancel",t.end),c(document,"touchmove",t.drag),c(window,"resize",t.recalculate),c(window,"scroll",t.recalculate)},t.prototype.start=function(t){if(t.preventDefault(),this.container.contains(t.target)){var e,s=this,n=this.config,o=l(t.target,function(t){return t===s.container||g.contains(t,n.classes.selectable)});if(!o||n.disabled)return!1;if(n.multiple){var c="touchstart"===t.type;if(this.dragging=!0,this.origin={x:c?t.touches[0].clientX:t.pageX,y:c?t.touches[0].clientY:t.pageY},this.autoscroll&&(this.origin.scroll={x:this.container.scrollLeft,y:this.container.scrollTop}),this.container.appendChild(this.lasso),o!==this.container&&g.add(o,n.classes.selecting),n.autoRefresh&&this.update(),i){var r=this.get(o);if(r.selected)return this.dragging=!1,void this.unselect(r)}if(y(t)){var a=this.items,h=!1,u=this.items.length,f=function(t){return a[t].node===o&&(h=!0),!(!h||!a[t].selected)||(h&&(a[t].selecting=!0),!1)};if("normal"!==n.shiftDirection)for(var p=0;p<u&&!f(p);p++);else for(;u--&&!f(u););}}else this.select(o);d(this.items,function(s){var c=s.node;s.selected&&(s.startselected=!0,c!==o&&(n.multiple&&(i||m(t)||y(t))||(g.remove(c,n.classes.selected),s.selected=!1,g.add(c,n.classes.unselecting),s.unselecting=!0))),c===o&&(e=s)}),this.emit("selectable.start",e)}},t.prototype.drag=function(t){if(this.dragging&&!y(t)){var e=this.config;if(!e.disabled){var i,s,n=this,o=(e.classes,"touchstart"===t.type);this.offset=i={x1:this.origin.x,y1:this.origin.y,x2:o?t.touches[0].clientX:t.pageX,y2:o?t.touches[0].clientY:t.pageY,scroll:{x:0,y:0}},this.autoscroll&&(i.scroll={x:this.container.scrollLeft,y:this.container.scrollTop},this.scrolling={x:0,y:0},this.autoScroll(t)),i.x1>i.x2&&(s=i.x2,i.x2=i.x1,i.x1=s),i.y1>i.y2&&(s=i.y2,i.y2=i.y1,i.y1=s),d(this.items,function(e){n.highlight(e,m(t))});var c={x1:i.x1+this.data.right,x2:i.x2+this.data.left-(i.x1+this.data.right),y1:i.y1+this.data.down,y2:i.y2+this.data.up-(i.y1+this.data.down)},l={opacity:1,left:c.x1,width:c.x2,top:c.y1,height:c.y2};this.autoscroll&&(l=h(l,{zIndex:0,position:"absolute",left:c.x1-this.size.rect.x1+this.offset.scroll.x,top:c.y1-this.size.rect.y1+this.offset.scroll.y})),u(this.lasso,l),this.emit("selectable.drag",c)}}},t.prototype.end=function(t){if(this.dragging||!this.config.multiple){this.dragging=!1,u(this.lasso,{opacity:0,left:0,width:0,top:0,height:0}),this.data.right=0,this.data.left=0,this.data.down=0,this.data.up=0;var e=[],i=[];d(this.items,function(t){t.node;t.unselecting&&(i.push(t),this.unselect(t)),t.selecting&&(e.push(t),this.select(t))},this),this.container.contains(this.lasso)&&this.container.removeChild(this.lasso),this.emit("selectable.end",e,i)}},t.prototype.keydown=function(t){m(t)&&(65!=t.keyCode&&97!=t.keyCode||(t.preventDefault(),this.selectAll()))},t.prototype.scroll=function(t){d(this.items,function(t){t.rect=f(t.node)})},t.prototype.autoScroll=function(t){var e=this.config.autoScroll,i=this.size.rect,s=this.offset.scroll.x,n=this.offset.scroll.y,o=this.size.w,c=this.size.h,l=0,r=0,a=s,h=n;(n>0||n<c-i.height)&&(t.pageY>=i.y2-e.offset||t.pageY<=i.y1+e.offset)&&(t.pageY>=i.y2-e.offset?(r=e.increment,this.scrolling.y=1):t.pageY<=i.y1+e.offset&&(r=-e.increment,this.scrolling.y=-1),h+=r,this.container.scrollTop=this.offset.scroll.y=h),(s>0||s<o-i.width)&&(t.pageX>=i.x2-e.offset||t.pageX<=i.x1+e.offset)&&(t.pageX>=i.x2-e.offset?(l=e.increment,this.scrolling.x=1):t.pageX<=i.x1+e.offset&&(l=-e.increment,this.scrolling.x=-1),a+=l,this.container.scrollLeft=this.offset.scroll.x=a),this.data.x=this.origin.scroll.x-this.offset.scroll.x,this.data.y=this.origin.scroll.y-this.offset.scroll.y,this.scrolling.x>0?this.data.right=this.data.x:this.scrolling.x<0&&(this.data.left=this.data.x),this.scrolling.y>0?this.data.down=this.data.y:this.scrolling.y<0&&(this.data.up=this.data.y)},t.prototype.highlight=function(t,e){var i=this.offset,s=this.config,n=s.classes,o=t.node,c=t.rect,l=this.data,r=!1;"touch"==s.tolerance?r=!(c.x1>i.x2+l.left||c.x2<i.x1+l.right||c.y1>i.y2+l.up||c.y2<i.y1+l.down):"fit"==s.tolerance&&(r=c.x1>i.x1+l.right&&c.x2<i.x2+l.left&&c.y1>i.y1+l.down&&c.y2<i.y2+l.up),r?(t.selected&&(g.remove(o,n.selected),t.selected=!1),t.unselecting&&(g.remove(o,n.unselecting),t.unselecting=!1),t.selecting||(g.add(o,n.selecting),t.selecting=!0)):(t.selecting&&(e&&t.startselected?(g.remove(o,n.selecting),t.selecting=!1,g.add(o,n.selected),t.selected=!0):(g.remove(o,n.selecting),t.selecting=!1,t.startselected&&(g.add(o,n.unselecting),t.unselecting=!0))),o.selected&&(e||t.startselected||(g.remove(o,n.selected),t.selected=!1,g.add(o,n.unselecting),t.unselecting=!0)))},t.prototype.setContainer=function(t){var e,i=this.config;if(this.container&&(e=this.container,this.unbind()),t=t||i.appendTo,"string"==typeof t?this.container=document.querySelector(t):t instanceof Element&&t.nodeName&&(this.container=t),g.add(this.container,this.config.classes.container),this.config.multiple&&g.add(this.container,this.config.classes.multiple),e&&(g.remove(e,this.config.classes.container),this.config.multiple&&g.remove(e,this.config.classes.multiple)),a(i.filter)?this.nodes=[].slice.call(i.filter):"string"==typeof i.filter&&(this.nodes=[].slice.call(this.container.querySelectorAll(i.filter))),this.autoscroll){"static"===u(this.container).position&&u(this.container,{position:"relative"})}this.bind()},t.prototype.select=function(t){if(a(t))return d(t,function(t){this.select(t)},this),this.getSelectedItems();if(t=this.get(t)){var e=t.node,i=this.config.classes;return g.remove(e,i.selecting),g.add(e,i.selected),t.selecting=!1,t.selected=!0,t.startselected=!0,this.emit("selectable.select",t),t}return!1},t.prototype.unselect=function(t){if(a(t))return d(t,function(t){this.unselect(t)},this),this.getSelectedItems();if(t=this.get(t)){var e=t.node,i=this.config.classes;return t.selecting=!1,t.selected=!1,t.unselecting=!1,t.startselected=!1,g.remove(e,i.unselecting),g.remove(e,i.selecting),g.remove(e,i.selected),this.emit("selectable.unselect",t),t}return!1},t.prototype.add=function(t){this.config;a(t)?d(t,function(t){this.nodes.indexOf(t)<0&&t instanceof Element&&this.nodes.push(t)},this):this.nodes.indexOf(t)<0&&t instanceof Element&&this.nodes.push(t),this.update()},t.prototype.remove=function(t,e){if(t=this.get(t)){if(a(t))for(var i=t.length-1;i>=0;i--)this.remove(t[i],i>0);else{var s=t.node,n=this.config.classes,o=g.remove;o(s,n.selectable),o(s,n.unselecting),o(s,n.selecting),o(s,n.selected),this.nodes.splice(this.nodes.indexOf(t.node),1)}return e||this.update(),!0}return!1},t.prototype.recalculate=function(){d(this.nodes,function(t,e){this.items[e].rect=f(t)},this),this.emit("selectable.recalculate")},t.prototype.selectAll=function(){d(this.items,function(t){this.select(t)},this)},t.prototype.clear=function(){for(var t=this.items.length-1;t>=0;t--)this.unselect(this.items[t])},t.prototype.get=function(t){var e=!1;return a(t)?(e=[],d(t,function(t){(t=this.get(t))&&e.push(t)},this)):isNaN(t)?t instanceof Element?e=this.items[this.nodes.indexOf(t)]:r(t)&&this.items.indexOf(t)>=0&&(e=t):this.items.indexOf(this.items[t])>=0&&(e=this.items[t]),e},t.prototype.getItems=function(){return this.items},t.prototype.getNodes=function(){return this.nodes},t.prototype.getSelectedItems=function(){return this.getItems().filter(function(t){return t.selected})},t.prototype.getSelectedNodes=function(){return this.getSelectedItems().map(function(t){return t.node})},t.prototype.on=function(t,e){this.events=this.events||{},this.events[t]=this.events[t]||[],this.events[t].push(e)},t.prototype.off=function(t,e){this.events=this.events||{},t in this.events!=!1&&this.events[t].splice(this.events[t].indexOf(e),1)},t.prototype.emit=function(t){if(this.events=this.events||{},t in this.events!=!1)for(var e=0;e<this.events[t].length;e++)this.events[t][e].apply(this,Array.prototype.slice.call(arguments,1))},t.prototype.enable=function(){return this.enabled||(this.enabled=!0,this.bind(),g.add(this.container,this.config.classes.container),this.config.multiple&&g.add(this.container,this.config.classes.multiple),this.emit("selectable.enable")),this.enabled},t.prototype.disable=function(){return this.enabled&&(this.enabled=!1,this.unbind(),g.remove(this.container,this.config.classes.container),this.config.multiple&&g.remove(this.container,this.config.classes.multiple),this.emit("selectable.disable")),this.enabled},t.prototype.destroy=function(){this.config.classes;this.disable(),this.remove(this.items),d(this,function(t,e){"version"!==e&&"config"!==e&&delete this[e]},this)},t});